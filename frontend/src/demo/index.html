<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeBox Plugin System Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .plugin-container {
            background: #f9f9f9;
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            min-height: 200px;
            margin: 20px 0;
        }
        
        .button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 12px;
            margin-bottom: 8px;
        }
        
        .button:hover {
            background: #1976D2;
        }
        
        .button.success {
            background: #4CAF50;
        }
        
        .button.warning {
            background: #FF9800;
        }
        
        .button.danger {
            background: #F44336;
        }
        
        .status {
            padding: 12px;
            border-radius: 6px;
            margin: 12px 0;
            font-family: monospace;
        }
        
        .status.success {
            background: #e8f5e8;
            border: 1px solid #4CAF50;
            color: #2e7d32;
        }
        
        .status.error {
            background: #ffebee;
            border: 1px solid #F44336;
            color: #c62828;
        }
        
        .status.info {
            background: #e3f2fd;
            border: 1px solid #2196F3;
            color: #1565c0;
        }
        
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            max-width: 400px;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        @keyframes fadeInScale {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        @keyframes fadeOutScale {
            from { transform: scale(1); opacity: 1; }
            to { transform: scale(0.9); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ”Œ LifeBox Plugin System Demo</h1>
        <p>This demo showcases the LifeBox plugin system capabilities including dynamic plugin loading, event handling, storage, and UI management.</p>
        
        <div>
            <button class="button" onclick="initializeSystem()">Initialize Plugin System</button>
            <button class="button success" onclick="loadDemoPlugin()">Load Demo Plugin</button>
            <button class="button warning" onclick="testEventSystem()">Test Events</button>
            <button class="button" onclick="testStorage()">Test Storage</button>
            <button class="button" onclick="showDialog()">Show Dialog</button>
            <button class="button danger" onclick="unloadPlugin()">Unload Plugin</button>
        </div>
        
        <div id="status" class="status info">Ready to initialize plugin system...</div>
        
        <h3>Plugin Container</h3>
        <div id="plugin-root" class="plugin-container">
            <p style="text-align: center; color: #666; margin: 0;">Plugin container - plugins will be loaded here</p>
        </div>
        
        <h3>Console Output</h3>
        <div id="console" style="background: #1e1e1e; color: #d4d4d4; padding: 16px; border-radius: 6px; font-family: monospace; height: 200px; overflow-y: auto; white-space: pre-wrap;"></div>
    </div>

    <script type="module">
        // Mock implementation for demo purposes
        let pluginSystem = null;
        let demoPlugin = null;
        let pluginAPI = null;
        
        // Console output functionality
        const consoleElement = document.getElementById('console');
        const originalConsole = {
            log: console.log,
            info: console.info,
            warn: console.warn,
            error: console.error
        };
        
        function appendToConsole(level, message) {
            const timestamp = new Date().toLocaleTimeString();
            const levelColors = {
                log: '#d4d4d4',
                info: '#4fc3f7',
                warn: '#ffb74d',
                error: '#f06292'
            };
            
            const logEntry = document.createElement('div');
            logEntry.style.color = levelColors[level] || '#d4d4d4';
            logEntry.textContent = `[${timestamp}] ${level.toUpperCase()}: ${message}`;
            consoleElement.appendChild(logEntry);
            consoleElement.scrollTop = consoleElement.scrollHeight;
        }
        
        // Override console methods
        ['log', 'info', 'warn', 'error'].forEach(level => {
            console[level] = function(...args) {
                originalConsole[level].apply(console, args);
                appendToConsole(level, args.join(' '));
            };
        });
        
        function updateStatus(message, type = 'info') {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }
        
        // Mock plugin system implementation for demo
        window.initializeSystem = function() {
            console.info('Initializing LifeBox Plugin System...');
            
            // Mock initialization
            setTimeout(() => {
                pluginSystem = { initialized: true };
                console.info('âœ… Plugin system initialized successfully');
                updateStatus('Plugin system initialized - ready to load plugins', 'success');
                
                // Initialize mock global API
                window.LifeBoxAPI = {
                    createAPI: (pluginId) => ({
                        events: {
                            on: (type, handler) => console.info(`Event listener added for: ${type}`),
                            emit: (type, data) => console.info(`Event emitted: ${type}`, data),
                        },
                        storage: {
                            get: async (key) => {
                                console.info(`Storage get: ${key}`);
                                return { demo: 'data', timestamp: Date.now() };
                            },
                            set: async (key, value) => console.info(`Storage set: ${key}`, value),
                        },
                        ui: {
                            createContainer: (id) => {
                                const container = document.createElement('div');
                                container.id = `plugin-${id}`;
                                container.className = 'plugin-container';
                                document.getElementById('plugin-root').appendChild(container);
                                return container;
                            },
                            showNotification: (message, type) => showNotification(message, type),
                            showDialog: (config) => showMockDialog(config),
                        },
                        http: {
                            get: async (url) => {
                                console.info(`HTTP GET: ${url}`);
                                return { demo: 'response' };
                            },
                        },
                        logger: {
                            info: (msg) => console.info(`[Plugin] ${msg}`),
                            warn: (msg) => console.warn(`[Plugin] ${msg}`),
                            error: (msg) => console.error(`[Plugin] ${msg}`),
                        }
                    })
                };
                
                window.LifeBoxPlugins = {};
            }, 1000);
        };
        
        window.loadDemoPlugin = function() {
            if (!pluginSystem?.initialized) {
                updateStatus('Please initialize the plugin system first', 'error');
                return;
            }
            
            console.info('Loading demo plugin...');
            
            // Create plugin API
            pluginAPI = window.LifeBoxAPI.createAPI('demo-plugin');
            
            // Mock plugin class
            class DemoPlugin {
                constructor(api, manifest) {
                    this.api = api;
                    this.manifest = manifest;
                }
                
                async onLoad() {
                    this.api.logger.info('Demo plugin loaded successfully');
                    
                    const container = this.api.ui.createContainer('demo-plugin');
                    container.innerHTML = `
                        <div style="padding: 16px; border: 2px solid #2196F3; border-radius: 8px; background: white;">
                            <h4>ðŸ”Œ Demo Plugin Loaded</h4>
                            <p>This plugin demonstrates the LifeBox plugin system capabilities.</p>
                            <button onclick="window.triggerPluginEvent()" style="padding: 8px 16px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                Trigger Event
                            </button>
                            <button onclick="window.testPluginStorage()" style="padding: 8px 16px; background: #FF9800; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 8px;">
                                Test Storage
                            </button>
                        </div>
                    `;
                    
                    // Setup event listeners
                    this.api.events.on('demo:test', (data) => {
                        this.api.logger.info('Received test event:', data);
                        this.api.ui.showNotification('Event received by plugin!', 'success');
                    });
                }
                
                async onUnload() {
                    this.api.logger.info('Demo plugin unloaded');
                    const container = document.getElementById('plugin-demo-plugin');
                    if (container) {
                        container.remove();
                    }
                }
            }
            
            // Create plugin instance
            demoPlugin = new DemoPlugin(pluginAPI, {
                id: 'demo-plugin',
                name: 'Demo Plugin',
                version: '1.0.0'
            });
            
            setTimeout(async () => {
                await demoPlugin.onLoad();
                console.info('âœ… Demo plugin loaded successfully');
                updateStatus('Demo plugin loaded and ready', 'success');
            }, 500);
        };
        
        window.testEventSystem = function() {
            if (!pluginAPI) {
                updateStatus('Please load the demo plugin first', 'error');
                return;
            }
            
            console.info('Testing event system...');
            pluginAPI.events.emit('demo:test', { 
                message: 'Test event from system',
                timestamp: Date.now()
            });
            updateStatus('Event emitted successfully', 'success');
        };
        
        window.testStorage = function() {
            if (!pluginAPI) {
                updateStatus('Please load the demo plugin first', 'error');
                return;
            }
            
            console.info('Testing storage system...');
            pluginAPI.storage.set('demo-key', { 
                value: 'Hello from storage!',
                timestamp: Date.now()
            }).then(() => {
                return pluginAPI.storage.get('demo-key');
            }).then(data => {
                console.info('Storage test result:', data);
                showNotification('Storage test completed!', 'success');
                updateStatus('Storage test completed successfully', 'success');
            });
        };
        
        window.triggerPluginEvent = function() {
            if (pluginAPI) {
                pluginAPI.events.emit('demo:test', {
                    source: 'plugin-button',
                    message: 'Event triggered from plugin UI'
                });
            }
        };
        
        window.testPluginStorage = function() {
            if (pluginAPI) {
                window.testStorage();
            }
        };
        
        window.showDialog = function() {
            if (!pluginAPI) {
                updateStatus('Please load the demo plugin first', 'error');
                return;
            }
            
            pluginAPI.ui.showDialog({
                title: 'Demo Dialog',
                content: 'This is a demonstration of the plugin dialog system.',
                buttons: [
                    { text: 'OK', type: 'primary' },
                    { text: 'Cancel', type: 'secondary' }
                ]
            });
        };
        
        window.unloadPlugin = function() {
            if (!demoPlugin) {
                updateStatus('No plugin to unload', 'error');
                return;
            }
            
            console.info('Unloading demo plugin...');
            demoPlugin.onUnload();
            demoPlugin = null;
            pluginAPI = null;
            updateStatus('Plugin unloaded successfully', 'success');
        };
        
        // Notification system
        function showNotification(message, type = 'info') {
            const container = getNotificationContainer();
            const notification = document.createElement('div');
            
            const colors = {
                info: '#2196F3',
                success: '#4CAF50',
                warning: '#FF9800',
                error: '#F44336'
            };
            
            notification.style.cssText = `
                background: ${colors[type]};
                color: white;
                padding: 12px 16px;
                margin-bottom: 8px;
                border-radius: 4px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                animation: slideInRight 0.3s ease-out;
                cursor: pointer;
                display: flex;
                justify-content: space-between;
                align-items: center;
            `;
            
            notification.innerHTML = `
                <span>${message}</span>
                <span style="margin-left: 12px; font-weight: bold;">&times;</span>
            `;
            
            notification.addEventListener('click', () => {
                notification.style.animation = 'slideOutRight 0.3s ease-in';
                setTimeout(() => notification.remove(), 300);
            });
            
            container.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideOutRight 0.3s ease-in';
                    setTimeout(() => notification.remove(), 300);
                }
            }, 5000);
        }
        
        function getNotificationContainer() {
            let container = document.querySelector('.notification-container');
            if (!container) {
                container = document.createElement('div');
                container.className = 'notification-container';
                document.body.appendChild(container);
            }
            return container;
        }
        
        // Mock dialog system
        function showMockDialog(config) {
            console.info('Showing dialog:', config.title);
            showNotification(`Dialog: ${config.title}`, 'info');
        }
        
        // Initial status
        console.info('LifeBox Plugin System Demo Ready');
        console.info('Click "Initialize Plugin System" to begin');
    </script>
</body>
</html>